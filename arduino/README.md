# Arduino HID Emulator

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

Этот проект реализует эмулятор HID-устройства на базе Arduino, который позволяет управлять мышью и клавиатурой с помощью последовательных команд. Он подходит для задач автоматизации и тестирования.

Обратите внимание, что функционал эмулятора ограничен. Например, поддерживаются комбинации клавиш только с одним модификатором.

## Необходимое оборудование

Для работы с данным проектом требуются платы Arduino, поддерживающие функциональность **HID (Human Interface Device)**. Это значит, что плата должна иметь встроенный USB-контроллер, способный эмулировать клавиатуру и мышь. Вот список совместимых плат:

---

### Совместимые платы

1. **Arduino Leonardo**
   - Имеет встроенный USB-контроллер.
   - Полностью поддерживает эмуляцию клавиатуры и мыши.

2. **Arduino Pro Micro**
   - Основана на микроконтроллере ATmega32U4, который поддерживает HID.
   - Популярна благодаря компактным размерам.

3. **Arduino Micro**
   - Тоже основана на ATmega32U4.
   - Аналогична Leonardo, но в меньшем форм-факторе.

---

### Возможно совместимые платы, но не проверено

1. **Arduino Due**
   - Основана на ARM Cortex-M3.
   - Поддерживает HID через встроенный USB OTG.

2. **Teensy 2.0 и 3.x (или более новые версии)**
   - Имеют расширенные возможности HID.
   - Поддерживают как стандартные клавиатурные и мышиные команды, так и пользовательские HID-устройства.

3. **SparkFun Pro Micro (ATmega32U4)**
   - Полностью аналогична Arduino Pro Micro.
   - Компактная и хорошо совместима.

---

### Платы, которые **не совместимы**

- **Arduino Uno, Nano, Mini** (основаны на ATmega328P):
  - Эти платы используют внешний USB-чип (например, CH340 или FTDI), который не поддерживает HID.
  - Они не могут напрямую эмулировать клавиатуру или мышь.

- **Arduino Mega 2560**:
  - Хотя плата более мощная, чем Uno, она также использует внешний USB-чип и не поддерживает HID.

---

### Как проверить совместимость

1. Убедитесь, что плата поддерживает микроконтроллер **ATmega32U4** или аналогичный, с HID-функциональностью.
2. В описании платы ищите упоминания о возможности эмуляции клавиатуры и мыши.
3. Если вы не уверены, проверьте документацию вашей платы или задайте вопрос в [репозитории проекта](https://github.com/mvandrew/arduino-hid-emulator/issues).

---

### Рекомендации

Для этого проекта наиболее удобными и доступными являются **Arduino Leonardo** и **Arduino Pro Micro**. Они легко настраиваются, обладают достаточной мощностью и широко доступны.

---

## Возможности

- Управление мышью:
  - Прямолинейное перемещение (`mouse_move_direct`).
  - Плавное перемещение по кривой Безье с контролем границ (`mouse_move`).
  - Нажатие и отпускание кнопок мыши (`mouse_down`, `mouse_up`).
  - Эмуляция клика мыши (`mouse_click`).

- Управление клавиатурой:
  - Нажатие клавиши (`key_down`).
  - Отпускание клавиши (`key_up`).
  - Нажатие и отпускание клавиши (`key_press`).
  - Эмуляция сочетаний клавиш (`key_combo`).

## Команды

### Управление мышью

1. **Прямолинейное перемещение:**
   ```
   mouse_move_direct <X>,<Y>
   ```
   Перемещает указатель на заданное количество пикселей по осям X и Y.

2. **Плавное перемещение по кривой Безье:**
   ```
   mouse_move <X>,<Y>,<factorX>,<factorY>
   ```
   - `<X>,<Y>` — целевое смещение.
   - `<factorX>,<factorY>` — коэффициенты калибровки для точного перемещения.

3. **Нажатие кнопки мыши:**
   ```
   mouse_down <button>
   ```
   - `<button>` — `left` или `right`.

4. **Отпускание кнопки мыши:**
   ```
   mouse_up <button>
   ```
   - `<button>` — `left` или `right`.

5. **Клик мыши:**
   ```
   mouse_click <button>
   ```
   - `<button>` — `left` или `right`.

### Управление клавиатурой

1. **Нажатие клавиши:**
   ```
   key_down <key>
   ```
   - `<key>` — символ клавиши (например, `a`, `ctrl`, `space`).

2. **Отпускание клавиши:**
   ```
   key_up <key>
   ```
   - `<key>` — символ клавиши.

3. **Нажатие и отпускание клавиши:**
   ```
   key_press <key>
   ```
   - `<key>` — символ клавиши.

4. **Сочетание клавиш:**
   ```
   key_combo <modifier>+<key>
   ```
   - `<modifier>` — модификатор (например, `ctrl`, `shift`, `alt`).
   - `<key>` — основная клавиша (например, `tab`, `f1`).

## Установка и настройка

1. **Подключите Arduino.**
   Убедитесь, что ваша плата поддерживает HID (например, Arduino Leonardo, Pro Micro).

2. **Установите зависимости:**
   Убедитесь, что в Arduino IDE установлены библиотеки `Keyboard` и `Mouse`.

3. **Загрузите скетч на Arduino:**
   - Откройте файл `hid_emulator.ino` в Arduino IDE.
   - Выберите правильный COM-порт и загрузите скетч.

4. **Подключите Python:**
   Используйте Python для отправки последовательных команд на Arduino.

   Пример отправки команды:

   ```python
   import serial

   arduino = serial.Serial("COM3", 9600)
   arduino.write(b"mouse_move_direct 100,50\n")
   ```

## Настройки

- Интервалы для клавиш и мыши:
  - `KEY_INTERVAL_MIN`, `KEY_INTERVAL_MAX` — минимальные и максимальные задержки для действий клавиатуры.
  - `MOUSE_MOVE_DURATION_MIN`, `MOUSE_MOVE_DURATION_MAX` — минимальная и максимальная длительность плавного движения мыши.

- Отклонение кривой Безье:
  - Отклонение опорных точек составляет 20% от длины прямой линии.

## Пример Python-клиента

```python
import serial

def send_command(command):
    arduino = serial.Serial("COM3", 9600)  # Укажите ваш COM-порт
    arduino.write((command + "\n").encode())
    response = arduino.readline().decode().strip()
    return response == "True"

# Примеры команд
send_command("mouse_move_direct 100,50")
send_command("key_press a")
send_command("mouse_click left")
send_command("key_combo ctrl+tab")
```

## Ограничения

- Поддерживаются только клавиши и кнопки, описанные в коде (например, `ctrl`, `alt`, `tab`, `space`).
- Координаты перемещения должны быть в пределах допустимого диапазона HID.

## Лицензия

Этот проект распространяется под лицензией [GNU General Public License v3.0](LICENSE).

---

Разработано и поддерживается [Andrey Mishchenko](https://github.com/mvandrew).  
Репозиторий: [arduino-hid-emulator](https://github.com/mvandrew/arduino-hid-emulator).

Если у вас возникли вопросы или предложения, создайте новый Issue в репозитории.
